<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»ªè¡¨æ¿ - INEY ä¸ªäººä»£å¸å‘è¡Œå¹³å°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- å¤šä¸ªethers.js CDNæºï¼Œç¡®ä¿åŠ è½½æˆåŠŸ -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="text/javascript"></script>
    <script>
        // å¦‚æœethersåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨CDN
        if (typeof ethers === 'undefined') {
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"><\/script>');
        }
    </script>
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, #0052ff 0%, #1652f0 100%);
            color: white;
            padding: 40px 0;
        }
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            height: 100%;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #0052ff;
            margin-bottom: 10px;
        }
        .contract-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #0052ff;
        }
        .network-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }
        .contract-address {
            font-family: 'Courier New', monospace;
            background: #e9ecef;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.85em;
            word-break: break-all;
        }
        .activity-item {
            border-left: 3px solid #0052ff;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 0 8px 8px 0;
        }
        .network-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <!-- ç½‘ç»œçŠ¶æ€æ˜¾ç¤º -->
    <div id="networkStatus" class="network-status"></div>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">ğŸª™ INEY ä¸ªäººä»£å¸å¹³å°</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">é¦–é¡µ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="create.html">åˆ›å»ºä»£å¸</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="trading.html">äº¤æ˜“</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="dashboard.html">ä»ªè¡¨æ¿</a>
                    </li>
                </ul>
                <button id="connectWallet" class="btn btn-outline-primary">
                    <i class="fas fa-wallet me-2"></i>è¿æ¥é’±åŒ…
                </button>
            </div>
        </div>
    </nav>

    <!-- ä»ªè¡¨æ¿å¤´éƒ¨ -->
    <section class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-6 fw-bold mb-3">ğŸ“Š å¹³å°ä»ªè¡¨æ¿</h1>
                    <p class="lead">Base ä¸»ç½‘å¹³å°ç»Ÿè®¡å’Œåˆçº¦ä¿¡æ¯</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="network-info text-dark">
                        <div class="row text-center">
                            <div class="col-12">
                                <strong>Base Mainnet</strong><br>
                                <small>Chain ID: 8453</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">ğŸ“ˆ å¹³å°ç»Ÿè®¡</h2>
            <div class="row" id="statsContainer">
                <div class="col-md-3 mb-4">
                    <div class="stat-card">
                        <div class="stat-number" id="totalTokens">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <h5>å·²åˆ›å»ºä»£å¸</h5>
                        <p class="text-muted">æ€»ä»£å¸åˆ›å»ºæ•°é‡</p>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <h5>æ´»è·ƒç”¨æˆ·</h5>
                        <p class="text-muted">ä½¿ç”¨å¹³å°çš„ç”¨æˆ·æ•°</p>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="stat-card">
                        <div class="stat-number" id="totalValue">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <h5>é”å®šä»·å€¼ (ETH)</h5>
                        <p class="text-muted">å¹³å°æ€»é”å®šä»·å€¼</p>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="stat-card">
                        <div class="stat-number" id="platformFees">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <h5>å¹³å°è´¹ç”¨ (ETH)</h5>
                        <p class="text-muted">ç´¯è®¡æ”¶å–è´¹ç”¨</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- åˆçº¦ä¿¡æ¯ -->
    <section class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">ğŸ”— æ™ºèƒ½åˆçº¦ä¿¡æ¯</h2>
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <div class="contract-card">
                        <h5 class="fw-bold mb-3">
                            <i class="fas fa-factory-line me-2 text-primary"></i>SimpleTokenFactory
                        </h5>
                        <p class="text-muted">ä»£å¸å·¥å‚åˆçº¦ï¼Œå¤„ç†ä»£å¸åˆ›å»ºè¯·æ±‚</p>
                        <div class="contract-address mb-3">0x09F80281c90d574B4C5769cf2308ea4B70b4f468</div>
                        <div class="d-flex gap-2">
                            <a href="https://basescan.org/address/0x09F80281c90d574B4C5769cf2308ea4B70b4f468" 
                               target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-external-link-alt me-1"></i>æµè§ˆå™¨æŸ¥çœ‹
                            </a>
                            <button class="btn btn-sm btn-outline-success" onclick="interactWithFactory()">
                                <i class="fas fa-play me-1"></i>äº¤äº’æµ‹è¯•
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4 mb-4">
                    <div class="contract-card">
                        <h5 class="fw-bold mb-3">
                            <i class="fas fa-coins me-2 text-success"></i>PersonalToken
                        </h5>
                        <p class="text-muted">INEY ä¸ªäººä»£å¸æ¨¡æ¿åˆçº¦</p>
                        <div class="contract-address mb-3">0xd3F54d1e5909a8ae1E15DBf1e27825e716B26d0E</div>
                        <div class="d-flex gap-2">
                            <a href="https://basescan.org/address/0xd3F54d1e5909a8ae1E15DBf1e27825e716B26d0E" 
                               target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-external-link-alt me-1"></i>æµè§ˆå™¨æŸ¥çœ‹
                            </a>
                            <button class="btn btn-sm btn-outline-success" onclick="checkTokenInfo()">
                                <i class="fas fa-info me-1"></i>æŸ¥çœ‹ä¿¡æ¯
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4 mb-4">
                    <div class="contract-card">
                        <h5 class="fw-bold mb-3">
                            <i class="fas fa-exchange-alt me-2 text-info"></i>SimpleAMM
                        </h5>
                        <p class="text-muted">è‡ªåŠ¨åšå¸‚å•†åˆçº¦</p>
                        <div class="contract-address mb-3">0x8C53A213B97B52989BCCE04fE306464e6767BC75</div>
                        <div class="d-flex gap-2">
                            <a href="https://basescan.org/address/0x8C53A213B97B52989BCCE04fE306464e6767BC75" 
                               target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-external-link-alt me-1"></i>æµè§ˆå™¨æŸ¥çœ‹
                            </a>
                            <button class="btn btn-sm btn-outline-success" onclick="checkAMMInfo()">
                                <i class="fas fa-chart-line me-1"></i>AMMä¿¡æ¯
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- æœ€è¿‘æ´»åŠ¨ -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">ğŸ“° å¹³å°åŠ¨æ€</h2>
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="activity-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="fw-bold">ğŸ‰ å¹³å°æˆåŠŸéƒ¨ç½²åˆ° Base ä¸»ç½‘</h6>
                                <p class="text-muted mb-2">æ‰€æœ‰æ ¸å¿ƒåˆçº¦å·²éƒ¨ç½²å®Œæˆå¹¶é€šè¿‡éªŒè¯æµ‹è¯•</p>
                                <small class="text-muted">2025-07-14 23:48:00</small>
                            </div>
                            <span class="badge bg-success">å®Œæˆ</span>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="fw-bold">ğŸ­ SimpleTokenFactory é¦–æ¬¡åˆ›å»ºæµ‹è¯•</h6>
                                <p class="text-muted mb-2">æˆåŠŸå¤„ç†ç¬¬ä¸€ä¸ªä»£å¸åˆ›å»ºè¯·æ±‚ï¼Œå¹³å°è´¹ç”¨æœºåˆ¶æ­£å¸¸å·¥ä½œ</p>
                                <small class="text-muted">2025-07-14 23:47:00</small>
                            </div>
                            <span class="badge bg-success">æˆåŠŸ</span>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="fw-bold">ğŸ“± PersonalToken æ¨¡æ¿éƒ¨ç½²</h6>
                                <p class="text-muted mb-2">Template Token (TMPL) å·²éƒ¨ç½²ï¼Œ1Mä»£å¸ä¾›åº”é‡</p>
                                <small class="text-muted">2025-07-14 23:42:00</small>
                            </div>
                            <span class="badge bg-success">å®Œæˆ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ä¿¡æ¯æ¨¡æ€æ¡† -->
    <div class="modal fade" id="infoModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="infoModalTitle">åˆçº¦ä¿¡æ¯</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="infoModalBody">
                    <!-- å†…å®¹å°†é€šè¿‡JavaScriptæ’å…¥ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ç½‘ç»œé…ç½®
        const NETWORK_CONFIG = {
            chainId: 8453,
            name: "Base Mainnet",
            rpcUrl: "https://mainnet.base.org",
            explorer: "https://basescan.org",
            contracts: {
                TokenFactory: "0x09F80281c90d574B4C5769cf2308ea4B70b4f468",
                PersonalToken: "0xd3F54d1e5909a8ae1E15DBf1e27825e716B26d0E",
                SimpleAMM: "0x8C53A213B97B52989BCCE04fE306464e6767BC75"
            }
        };

        // åˆçº¦ ABI
        const TOKEN_FACTORY_ABI = [
            "function creationFee() external view returns (uint256)",
            "function totalTokensCreated() external view returns (uint256)",
            "function totalFeesCollected() external view returns (uint256)",
            "function getUserTokenCount(address user) external view returns (uint256)"
        ];

        const PERSONAL_TOKEN_ABI = [
            "function name() external view returns (string)",
            "function symbol() external view returns (string)",
            "function totalSupply() external view returns (uint256)",
            "function decimals() external view returns (uint8)",
            "function balanceOf(address account) external view returns (uint256)",
            "function owner() external view returns (address)"
        ];

        let provider = null;
        let signer = null;
        let userAccount = null;

        // ç¡®ä¿ethersåº“åŠ è½½å®Œæˆåå†åˆå§‹åŒ–
        function initializeApp() {
            if (typeof ethers === 'undefined') {
                console.error('ethersåº“æœªåŠ è½½ï¼Œç­‰å¾…é‡è¯•...');
                setTimeout(initializeApp, 500);
                return;
            }
            
            console.log('ethersåº“åŠ è½½æˆåŠŸï¼Œç‰ˆæœ¬:', ethers.version);
            initializeWeb3();
            loadDashboardData();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeApp, 100);
        });

        // åˆå§‹åŒ–Web3
        async function initializeWeb3() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    
                    // æ£€æŸ¥æ˜¯å¦å·²è¿æ¥
                    const accounts = await window.ethereum.request({method: 'eth_accounts'});
                    if (accounts.length > 0) {
                        await connectWallet();
                    }
                } catch (error) {
                    console.error('åˆå§‹åŒ–Web3å¤±è´¥:', error);
                    showNetworkStatus('error', 'åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                }
            } else {
                showNetworkStatus('warning', 'è¯·å®‰è£…MetaMaské’±åŒ…');
            }
        }

        // è¿æ¥é’±åŒ…
        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    showNetworkStatus('error', 'è¯·å®‰è£…MetaMaské’±åŒ…');
                    return;
                }

                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                if (!accounts || accounts.length === 0) {
                    showNetworkStatus('error', 'æ²¡æœ‰æ‰¾åˆ°è´¦æˆ·ï¼Œè¯·æ£€æŸ¥MetaMask');
                    return;
                }
                
                userAccount = accounts[0];
                
                if (!provider) {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                }
                
                try {
                    signer = provider.getSigner();
                } catch (signerError) {
                    console.error('è·å–Signerå¤±è´¥:', signerError);
                    showNetworkStatus('error', 'è·å–ç­¾åå™¨å¤±è´¥: ' + signerError.message);
                    return;
                }
                
                // æ£€æŸ¥ç½‘ç»œ
                try {
                    const network = await provider.getNetwork();
                    
                    if (network.chainId !== NETWORK_CONFIG.chainId) {
                        showNetworkStatus('warning', 'è¯·åˆ‡æ¢åˆ°Baseä¸»ç½‘');
                        return;
                    }
                } catch (networkError) {
                    console.error('è·å–ç½‘ç»œä¿¡æ¯å¤±è´¥:', networkError);
                    showNetworkStatus('warning', 'æ— æ³•è·å–ç½‘ç»œä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è¿æ¥');
                }
                
                showNetworkStatus('success', `å·²è¿æ¥: ${userAccount.slice(0,6)}...${userAccount.slice(-4)}`);
                updateConnectButton(true);
                
                // é‡æ–°åŠ è½½å®æ—¶æ•°æ®
                loadLiveData();
                
            } catch (error) {
                console.error('è¿æ¥é’±åŒ…è¯¦ç»†é”™è¯¯:', error);
                
                let errorMessage = 'è¿æ¥å¤±è´¥';
                if (error.code === 4001) {
                    errorMessage = 'ç”¨æˆ·æ‹’ç»äº†è¿æ¥è¯·æ±‚';
                } else if (error.code === -32002) {
                    errorMessage = 'MetaMaskæ­£åœ¨å¤„ç†è¯·æ±‚ï¼Œè¯·ç­‰å¾…';
                } else if (error.message) {
                    errorMessage = 'è¿æ¥å¤±è´¥: ' + error.message;
                } else {
                    errorMessage = 'è¿æ¥å¤±è´¥: æœªçŸ¥é”™è¯¯';
                }
                
                showNetworkStatus('error', errorMessage);
            }
        }

        // åŠ è½½ä»ªè¡¨æ¿æ•°æ®
        async function loadDashboardData() {
            try {
                // é™æ€ç‰ˆæœ¬æ˜¾ç¤ºå›ºå®šæ•°æ®
                document.getElementById('totalTokens').textContent = '1';
                document.getElementById('totalUsers').textContent = '1';
                document.getElementById('totalValue').textContent = '0.001';
                document.getElementById('platformFees').textContent = '0.001';
                
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                // æ˜¾ç¤ºé»˜è®¤æ•°æ®
                document.getElementById('totalTokens').textContent = '1';
                document.getElementById('totalUsers').textContent = '1';
                document.getElementById('totalValue').textContent = '0.001';
                document.getElementById('platformFees').textContent = '0.001';
            }
        }

        // åŠ è½½å®æ—¶æ•°æ®
        async function loadLiveData() {
            if (!provider) return;

            try {
                // è¿æ¥åˆ°TokenFactoryåˆçº¦è·å–å®æ—¶æ•°æ®
                const factoryContract = new ethers.Contract(
                    NETWORK_CONFIG.contracts.TokenFactory,
                    TOKEN_FACTORY_ABI,
                    provider
                );

                const totalCreated = await factoryContract.totalTokensCreated();
                const totalFees = await factoryContract.totalFeesCollected();
                
                document.getElementById('totalTokens').textContent = totalCreated.toString();
                document.getElementById('platformFees').textContent = ethers.utils.formatEther(totalFees);

            } catch (error) {
                console.error('åŠ è½½å®æ—¶æ•°æ®å¤±è´¥:', error);
            }
        }

        // ä¸TokenFactoryäº¤äº’
        async function interactWithFactory() {
            if (!provider) {
                showNetworkStatus('warning', 'è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }

            try {
                const factoryContract = new ethers.Contract(
                    NETWORK_CONFIG.contracts.TokenFactory,
                    TOKEN_FACTORY_ABI,
                    provider
                );

                const creationFee = await factoryContract.creationFee();
                const totalCreated = await factoryContract.totalTokensCreated();
                const totalFees = await factoryContract.totalFeesCollected();

                let userTokenCount = 'æœªè¿æ¥é’±åŒ…';
                if (userAccount) {
                    const userCount = await factoryContract.getUserTokenCount(userAccount);
                    userTokenCount = userCount.toString();
                }

                showInfoModal('SimpleTokenFactory åˆçº¦ä¿¡æ¯', `
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">åˆ›å»ºè´¹ç”¨</label>
                            <div class="form-control">${ethers.utils.formatEther(creationFee)} ETH</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">å·²åˆ›å»ºä»£å¸æ€»æ•°</label>
                            <div class="form-control">${totalCreated.toString()}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">å·²æ”¶é›†è´¹ç”¨</label>
                            <div class="form-control">${ethers.utils.formatEther(totalFees)} ETH</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">æ‚¨çš„ä»£å¸æ•°é‡</label>
                            <div class="form-control">${userTokenCount}</div>
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <strong>åˆçº¦åŠŸèƒ½ï¼š</strong>
                        <ul class="mb-0">
                            <li>requestTokenCreation() - è¯·æ±‚åˆ›å»ºä»£å¸</li>
                            <li>setCreationFee() - è®¾ç½®åˆ›å»ºè´¹ç”¨ (ä»…æ‰€æœ‰è€…)</li>
                            <li>withdrawFees() - æå–å¹³å°è´¹ç”¨ (ä»…æ‰€æœ‰è€…)</li>
                        </ul>
                    </div>
                `);

            } catch (error) {
                console.error('è·å–åˆçº¦ä¿¡æ¯å¤±è´¥:', error);
                showNetworkStatus('error', 'è·å–åˆçº¦ä¿¡æ¯å¤±è´¥: ' + error.message);
            }
        }

        // æ£€æŸ¥ä»£å¸ä¿¡æ¯
        async function checkTokenInfo() {
            if (!provider) {
                showNetworkStatus('warning', 'è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }

            try {
                const tokenContract = new ethers.Contract(
                    NETWORK_CONFIG.contracts.PersonalToken,
                    PERSONAL_TOKEN_ABI,
                    provider
                );

                const name = await tokenContract.name();
                const symbol = await tokenContract.symbol();
                const totalSupply = await tokenContract.totalSupply();
                const decimals = await tokenContract.decimals();
                const owner = await tokenContract.owner();

                let userBalance = 'æœªè¿æ¥é’±åŒ…';
                if (userAccount) {
                    const balance = await tokenContract.balanceOf(userAccount);
                    userBalance = ethers.utils.formatEther(balance) + ' ' + symbol;
                }

                showInfoModal('PersonalToken æ¨¡æ¿ä¿¡æ¯', `
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">ä»£å¸åç§°</label>
                            <div class="form-control">${name}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">ä»£å¸ç¬¦å·</label>
                            <div class="form-control">${symbol}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">æ€»ä¾›åº”é‡</label>
                            <div class="form-control">${ethers.utils.formatEther(totalSupply)} ${symbol}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">å°æ•°ä½æ•°</label>
                            <div class="form-control">${decimals.toString()}</div>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label fw-bold">æ‰€æœ‰è€…</label>
                            <div class="form-control font-monospace">${owner}</div>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label fw-bold">æ‚¨çš„ä½™é¢</label>
                            <div class="form-control">${userBalance}</div>
                        </div>
                    </div>
                    <div class="alert alert-success">
                        <strong>è¿™æ˜¯ä¸ªäººä»£å¸æ¨¡æ¿ï¼š</strong> æ‰€æœ‰é€šè¿‡å¹³å°åˆ›å»ºçš„ä»£å¸éƒ½ä¼šåŸºäºè¿™ä¸ªæ¨¡æ¿ï¼ŒåŒ…å«ERC-20æ ‡å‡†åŠŸèƒ½å’Œæ‰©å±•ç‰¹æ€§ã€‚
                    </div>
                `);

            } catch (error) {
                console.error('è·å–ä»£å¸ä¿¡æ¯å¤±è´¥:', error);
                showNetworkStatus('error', 'è·å–ä»£å¸ä¿¡æ¯å¤±è´¥: ' + error.message);
            }
        }

        // æ£€æŸ¥AMMä¿¡æ¯
        async function checkAMMInfo() {
            showInfoModal('SimpleAMM è‡ªåŠ¨åšå¸‚å•†', `
                <div class="alert alert-info">
                    <h6 class="alert-heading">
                        <i class="fas fa-exchange-alt me-2"></i>SimpleAMM åŠŸèƒ½è¯´æ˜
                    </h6>
                    <ul class="mb-0">
                        <li><strong>æµåŠ¨æ€§æ± ç®¡ç†</strong> - ä¸ºä»£å¸å¯¹æä¾›æµåŠ¨æ€§</li>
                        <li><strong>è‡ªåŠ¨ä»·æ ¼å‘ç°</strong> - åŸºäºä¾›éœ€å…³ç³»è‡ªåŠ¨è°ƒæ•´ä»·æ ¼</li>
                        <li><strong>ä»£å¸äº¤æ¢</strong> - æ”¯æŒä»»æ„ERC-20ä»£å¸äº¤æ¢</li>
                        <li><strong>æµåŠ¨æ€§æŒ–çŸ¿</strong> - ä¸ºæµåŠ¨æ€§æä¾›è€…åˆ†é…å¥–åŠ±</li>
                    </ul>
                </div>
                
                <div class="alert alert-warning">
                    <h6 class="alert-heading">
                        <i class="fas fa-info-circle me-2"></i>å¼€å‘çŠ¶æ€
                    </h6>
                    <p class="mb-0">
                        SimpleAMM åˆçº¦å·²éƒ¨ç½²ï¼Œä½†äº¤æ˜“åŠŸèƒ½éœ€è¦ä¸å®é™…çš„PersonalTokenå®ä¾‹é…åˆä½¿ç”¨ã€‚
                        å½“å‰ç‰ˆæœ¬æ”¯æŒåŸºç¡€çš„AMMåŠŸèƒ½ï¼Œæœªæ¥å°†æ·»åŠ æ›´å¤šé«˜çº§ç‰¹æ€§ã€‚
                    </p>
                </div>
                
                <div class="row">
                    <div class="col-12 mb-3">
                        <label class="form-label fw-bold">åˆçº¦åœ°å€</label>
                        <div class="contract-address">${NETWORK_CONFIG.contracts.SimpleAMM}</div>
                    </div>
                </div>
            `);
        }

        // æ˜¾ç¤ºä¿¡æ¯æ¨¡æ€æ¡†
        function showInfoModal(title, content) {
            document.getElementById('infoModalTitle').textContent = title;
            document.getElementById('infoModalBody').innerHTML = content;
            new bootstrap.Modal(document.getElementById('infoModal')).show();
        }

        // æ˜¾ç¤ºç½‘ç»œçŠ¶æ€
        function showNetworkStatus(type, message) {
            const statusDiv = document.getElementById('networkStatus');
            const alertClass = type === 'success' ? 'alert-success' : 
                              type === 'warning' ? 'alert-warning' : 'alert-danger';
            
            statusDiv.innerHTML = `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'warning' ? 'exclamation-triangle' : 'times'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        }

        // æ›´æ–°è¿æ¥æŒ‰é’®
        function updateConnectButton(connected) {
            const btn = document.getElementById('connectWallet');
            if (connected) {
                btn.textContent = 'å·²è¿æ¥';
                btn.className = 'btn btn-success';
            } else {
                btn.innerHTML = '<i class="fas fa-wallet me-2"></i>è¿æ¥é’±åŒ…';
                btn.className = 'btn btn-outline-primary';
            }
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('connectWallet').addEventListener('click', connectWallet);

        // ç›‘å¬è´¦æˆ·å’Œç½‘ç»œå˜åŒ–
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    userAccount = null;
                    signer = null;
                    updateConnectButton(false);
                    showNetworkStatus('warning', 'é’±åŒ…å·²æ–­å¼€è¿æ¥');
                } else {
                    connectWallet();
                }
            });

            window.ethereum.on('chainChanged', function (chainId) {
                window.location.reload();
            });
        }

        // å®šæœŸåˆ·æ–°æ•°æ®
        setInterval(loadLiveData, 30000); // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
    </script>
</body>
</html> 