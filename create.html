<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›å»ºä»£å¸ - INEY ä¸ªäººä»£å¸å‘è¡Œå¹³å°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- å¤šä¸ªethers.js CDNæºï¼Œç¡®ä¿åŠ è½½æˆåŠŸ -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="text/javascript"></script>
    <script>
        // å¦‚æœethersåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨CDN
        if (typeof ethers === 'undefined') {
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"><\/script>');
        }
    </script>
    <style>
        .hero-section {
            background: linear-gradient(135deg, #0052ff 0%, #1652f0 100%);
            color: white;
            padding: 60px 0;
        }
        .form-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin-top: -50px;
            position: relative;
            z-index: 10;
        }
        .btn-primary-custom {
            background: linear-gradient(135deg, #0052ff 0%, #1652f0 100%);
            border: none;
            padding: 12px 30px;
            font-weight: bold;
            border-radius: 8px;
        }
        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 82, 255, 0.3);
        }
        .network-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .step {
            display: flex;
            align-items: center;
            margin: 0 15px;
        }
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        .step.active .step-number {
            background: #0052ff;
            color: white;
        }
        .preview-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .token-preview {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }
        .contract-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <!-- ç½‘ç»œçŠ¶æ€æ˜¾ç¤º -->
    <div id="networkStatus" class="network-status"></div>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">ğŸª™ INEY ä¸ªäººä»£å¸å¹³å°</a>
            <div class="d-flex">
                <button id="connectWallet" class="btn btn-outline-primary">
                    <i class="fas fa-wallet me-2"></i>è¿æ¥é’±åŒ…
                </button>
            </div>
        </div>
    </nav>

    <!-- è‹±é›„åŒºåŸŸ -->
    <section class="hero-section text-center">
        <div class="container">
            <h1 class="display-5 fw-bold mb-3">ğŸš€ INEY åˆ›å»ºæ‚¨çš„ä¸ªäººä»£å¸</h1>
            <p class="lead">åœ¨Baseä¸»ç½‘ä¸Šåˆ›å»ºå±äºæ‚¨çš„ä»£å¸ï¼Œä»…éœ€0.001 ETH</p>
        </div>
    </section>

    <!-- åˆ›å»ºè¡¨å• -->
    <section class="py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="form-container">
                        <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
                        <div class="step-indicator">
                            <div class="step active" id="step1">
                                <div class="step-number">1</div>
                                <span>å¡«å†™ä¿¡æ¯</span>
                            </div>
                            <div class="step" id="step2">
                                <div class="step-number">2</div>
                                <span>è¿æ¥é’±åŒ…</span>
                            </div>
                            <div class="step" id="step3">
                                <div class="step-number">3</div>
                                <span>åˆ›å»ºä»£å¸</span>
                            </div>
                        </div>

                        <!-- ç½‘ç»œä¿¡æ¯ -->
                        <div class="contract-info">
                            <h6 class="fw-bold mb-3">
                                <i class="fas fa-network-wired me-2"></i>ç½‘ç»œä¿¡æ¯
                            </h6>
                            <div class="row text-center">
                                <div class="col-md-4">
                                    <small class="text-muted">ç½‘ç»œ</small><br>
                                    <strong>Base Mainnet</strong>
                                </div>
                                <div class="col-md-4">
                                    <small class="text-muted">åˆçº¦åœ°å€</small><br>
                                    <small class="font-monospace">0x09F802...</small>
                                </div>
                                <div class="col-md-4">
                                    <small class="text-muted">åˆ›å»ºè´¹ç”¨</small><br>
                                    <strong>0.001 ETH</strong>
                                </div>
                            </div>
                        </div>

                        <!-- åˆ›å»ºè¡¨å• -->
                        <form id="tokenForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="tokenName" class="form-label fw-bold">
                                        <i class="fas fa-tag me-2"></i>ä»£å¸åç§° *
                                    </label>
                                    <input type="text" class="form-control" id="tokenName" placeholder="ä¾‹å¦‚ï¼šAliceçš„ç²‰ä¸å¸" required maxlength="50">
                                    <div class="form-text">ä»£å¸çš„å®Œæ•´åç§°ï¼Œæœ€å¤š50ä¸ªå­—ç¬¦</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="tokenSymbol" class="form-label fw-bold">
                                        <i class="fas fa-code me-2"></i>ä»£å¸ç¬¦å· *
                                    </label>
                                    <input type="text" class="form-control" id="tokenSymbol" placeholder="ä¾‹å¦‚ï¼šALICE" required maxlength="10" style="text-transform: uppercase;">
                                    <div class="form-text">ä»£å¸ç®€ç§°ï¼Œé€šå¸¸2-5ä¸ªå­—æ¯</div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="initialSupply" class="form-label fw-bold">
                                    <i class="fas fa-coins me-2"></i>åˆå§‹ä¾›åº”é‡ *
                                </label>
                                <input type="number" class="form-control" id="initialSupply" placeholder="1000000" required min="1" max="1000000000">
                                <div class="form-text">ä»£å¸çš„åˆå§‹å‘è¡Œæ•°é‡</div>
                            </div>

                            <div class="mb-3">
                                <label for="description" class="form-label fw-bold">
                                    <i class="fas fa-info-circle me-2"></i>ä»£å¸æè¿°
                                </label>
                                <textarea class="form-control" id="description" rows="3" placeholder="æè¿°æ‚¨çš„ä»£å¸ç”¨é€”å’Œç‰¹è‰²..." maxlength="200"></textarea>
                                <div class="form-text">å¯é€‰ï¼šæè¿°ä»£å¸çš„ç”¨é€”å’Œç‰¹è‰²</div>
                            </div>

                            <!-- ä»£å¸é¢„è§ˆ -->
                            <div class="token-preview" id="tokenPreview" style="display: none;">
                                <h5 class="mb-3">
                                    <i class="fas fa-eye me-2"></i>ä»£å¸é¢„è§ˆ
                                </h5>
                                <div class="row text-center">
                                    <div class="col-md-4">
                                        <div class="h4 text-primary" id="previewName">-</div>
                                        <small class="text-muted">ä»£å¸åç§°</small>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="h4 text-success" id="previewSymbol">-</div>
                                        <small class="text-muted">ä»£å¸ç¬¦å·</small>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="h4 text-info" id="previewSupply">-</div>
                                        <small class="text-muted">åˆå§‹ä¾›åº”é‡</small>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <small class="text-muted" id="previewDescription">-</small>
                                </div>
                            </div>

                            <!-- åŠ è½½çŠ¶æ€ -->
                            <div class="loading-spinner" id="loadingSpinner">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">å¤„ç†ä¸­...</span>
                                </div>
                                <p class="mt-3">æ­£åœ¨åˆ›å»ºä»£å¸ï¼Œè¯·ç¨å€™...</p>
                            </div>

                            <!-- æ“ä½œæŒ‰é’® -->
                            <div class="text-center mt-4">
                                <button type="button" class="btn btn-outline-secondary me-3" onclick="history.back()">
                                    <i class="fas fa-arrow-left me-2"></i>è¿”å›
                                </button>
                                <button type="submit" class="btn btn-primary-custom" id="createTokenBtn">
                                    <i class="fas fa-plus me-2"></i>åˆ›å»ºä»£å¸
                                </button>
                            </div>
                        </form>

                        <!-- æ³¨æ„äº‹é¡¹ -->
                        <div class="alert alert-info mt-4">
                            <h6 class="alert-heading">
                                <i class="fas fa-info-circle me-2"></i>é‡è¦æç¤º
                            </h6>
                            <ul class="mb-0">
                                <li>è¿™æ˜¯Baseä¸»ç½‘ç»œï¼Œä½¿ç”¨çœŸå®ETH</li>
                                <li>åˆ›å»ºè´¹ç”¨ï¼š0.001 ETH</li>
                                <li>ä»£å¸åˆ›å»ºåç«‹å³å¯ç”¨äºäº¤æ˜“</li>
                                <li>è¯·ç¡®ä¿MetaMaskå·²è¿æ¥åˆ°Baseä¸»ç½‘</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ç»“æœæ¨¡æ€æ¡† -->
    <div class="modal fade" id="resultModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resultTitle">
                        <i class="fas fa-check-circle text-success me-2"></i>ä»£å¸åˆ›å»ºæˆåŠŸ
                    </h5>
                </div>
                <div class="modal-body" id="resultBody">
                    <!-- ç»“æœå†…å®¹å°†é€šè¿‡JavaScriptæ’å…¥ -->
                </div>
                <div class="modal-footer">
                    <a href="index.html" class="btn btn-secondary">è¿”å›é¦–é¡µ</a>
                    <button type="button" class="btn btn-primary" onclick="createAnother()">åˆ›å»ºå¦ä¸€ä¸ªä»£å¸</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ç½‘ç»œé…ç½®
        const NETWORK_CONFIG = {
            chainId: 8453,
            name: "Base Mainnet",
            rpcUrl: "https://mainnet.base.org",
            explorer: "https://basescan.org",
            contracts: {
                TokenFactory: "0x09F80281c90d574B4C5769cf2308ea4B70b4f468"
            }
        };

        // SimpleTokenFactory åˆçº¦ ABI (ç®€åŒ–ç‰ˆ)
        const TOKEN_FACTORY_ABI = [
            "function requestTokenCreation(string memory _name, string memory _symbol, uint256 _initialSupply) external payable returns (bool)",
            "function creationFee() external view returns (uint256)",
            "function totalTokensCreated() external view returns (uint256)",
            "function getUserTokenCount(address user) external view returns (uint256)"
        ];

        let provider = null;
        let signer = null;
        let userAccount = null;
        let tokenFactoryContract = null;

        // ç¡®ä¿ethersåº“åŠ è½½å®Œæˆåå†åˆå§‹åŒ–
        function initializeApp() {
            if (typeof ethers === 'undefined') {
                console.error('ethersåº“æœªåŠ è½½ï¼Œç­‰å¾…é‡è¯•...');
                setTimeout(initializeApp, 500);
                return;
            }
            
            console.log('ethersåº“åŠ è½½æˆåŠŸï¼Œç‰ˆæœ¬:', ethers.version);
            initializeWeb3();
            setupFormListeners();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿æ‰€æœ‰è„šæœ¬éƒ½åŠ è½½å®Œæˆ
            setTimeout(initializeApp, 100);
        });

        // åˆå§‹åŒ–Web3
        async function initializeWeb3() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    
                    // æ£€æŸ¥æ˜¯å¦å·²è¿æ¥
                    const accounts = await window.ethereum.request({method: 'eth_accounts'});
                    if (accounts.length > 0) {
                        await connectWallet();
                    }
                } catch (error) {
                    console.error('åˆå§‹åŒ–Web3å¤±è´¥:', error);
                    showNetworkStatus('error', 'åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                }
            } else {
                showNetworkStatus('warning', 'è¯·å®‰è£…MetaMaské’±åŒ…');
            }
        }

        // è¿æ¥é’±åŒ…
        async function connectWallet() {
            try {
                // æ£€æŸ¥æ˜¯å¦å®‰è£…äº†MetaMask
                if (typeof window.ethereum === 'undefined') {
                    showNetworkStatus('error', 'è¯·å®‰è£…MetaMaské’±åŒ…');
                    return;
                }

                console.log('å¼€å§‹è¿æ¥é’±åŒ…...');
                
                // è¯·æ±‚è´¦æˆ·è®¿é—®æƒé™
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                console.log('è·å–åˆ°è´¦æˆ·:', accounts);
                
                if (!accounts || accounts.length === 0) {
                    showNetworkStatus('error', 'æ²¡æœ‰æ‰¾åˆ°è´¦æˆ·ï¼Œè¯·æ£€æŸ¥MetaMask');
                    return;
                }
                
                userAccount = accounts[0];
                console.log('å½“å‰è´¦æˆ·:', userAccount);
                
                // é‡æ–°åˆ›å»ºprovider
                if (!provider) {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    console.log('åˆ›å»ºWeb3ProvideræˆåŠŸ');
                }
                
                // è·å–signerå‰å…ˆæ£€æŸ¥provider
                if (!provider) {
                    showNetworkStatus('error', 'Web3Provideråˆ›å»ºå¤±è´¥');
                    return;
                }
                
                try {
                    signer = provider.getSigner();
                    console.log('è·å–SigneræˆåŠŸ');
                } catch (signerError) {
                    console.error('è·å–Signerå¤±è´¥:', signerError);
                    showNetworkStatus('error', 'è·å–ç­¾åå™¨å¤±è´¥: ' + signerError.message);
                    return;
                }
                
                // æ£€æŸ¥ç½‘ç»œ
                try {
                    const network = await provider.getNetwork();
                    console.log('å½“å‰ç½‘ç»œ:', network);
                    
                    if (network.chainId !== NETWORK_CONFIG.chainId) {
                        console.log('ç½‘ç»œä¸åŒ¹é…ï¼Œå°è¯•åˆ‡æ¢åˆ°Baseä¸»ç½‘');
                        await switchToBaseMainnet();
                        return;
                    }
                } catch (networkError) {
                    console.error('è·å–ç½‘ç»œä¿¡æ¯å¤±è´¥:', networkError);
                    showNetworkStatus('warning', 'æ— æ³•è·å–ç½‘ç»œä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è¿æ¥');
                }
                
                // åˆå§‹åŒ–åˆçº¦å®ä¾‹
                try {
                    tokenFactoryContract = new ethers.Contract(
                        NETWORK_CONFIG.contracts.TokenFactory,
                        TOKEN_FACTORY_ABI,
                        signer
                    );
                    console.log('åˆçº¦å®ä¾‹åˆ›å»ºæˆåŠŸ');
                } catch (contractError) {
                    console.error('åˆ›å»ºåˆçº¦å®ä¾‹å¤±è´¥:', contractError);
                    showNetworkStatus('error', 'åˆ›å»ºåˆçº¦å®ä¾‹å¤±è´¥: ' + contractError.message);
                    return;
                }
                
                showNetworkStatus('success', `å·²è¿æ¥: ${userAccount.slice(0,6)}...${userAccount.slice(-4)}`);
                updateConnectButton(true);
                updateStepIndicator(2);
                
            } catch (error) {
                console.error('è¿æ¥é’±åŒ…è¯¦ç»†é”™è¯¯:', error);
                
                let errorMessage = 'è¿æ¥å¤±è´¥';
                if (error.code === 4001) {
                    errorMessage = 'ç”¨æˆ·æ‹’ç»äº†è¿æ¥è¯·æ±‚';
                } else if (error.code === -32002) {
                    errorMessage = 'MetaMaskæ­£åœ¨å¤„ç†è¯·æ±‚ï¼Œè¯·ç­‰å¾…';
                } else if (error.message) {
                    errorMessage = 'è¿æ¥å¤±è´¥: ' + error.message;
                } else {
                    errorMessage = 'è¿æ¥å¤±è´¥: æœªçŸ¥é”™è¯¯';
                }
                
                showNetworkStatus('error', errorMessage);
            }
        }

        // åˆ‡æ¢åˆ°Baseä¸»ç½‘
        async function switchToBaseMainnet() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x' + NETWORK_CONFIG.chainId.toString(16) }],
                });
                
                // ç½‘ç»œåˆ‡æ¢æˆåŠŸåé‡æ–°è¿æ¥
                setTimeout(connectWallet, 1000);
                
            } catch (switchError) {
                // å¦‚æœç½‘ç»œä¸å­˜åœ¨ï¼Œæ·»åŠ ç½‘ç»œ
                if (switchError.code === 4902) {
                    await addBaseMainnetNetwork();
                } else {
                    throw switchError;
                }
            }
        }

        // æ·»åŠ Baseä¸»ç½‘
        async function addBaseMainnetNetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: '0x' + NETWORK_CONFIG.chainId.toString(16),
                        chainName: NETWORK_CONFIG.name,
                        nativeCurrency: {
                            name: 'ETH',
                            symbol: 'ETH',
                            decimals: 18,
                        },
                        rpcUrls: [NETWORK_CONFIG.rpcUrl],
                        blockExplorerUrls: [NETWORK_CONFIG.explorer],
                    }],
                });
                
                // ç½‘ç»œæ·»åŠ æˆåŠŸåé‡æ–°è¿æ¥
                setTimeout(connectWallet, 1000);
                
            } catch (error) {
                console.error('æ·»åŠ ç½‘ç»œå¤±è´¥:', error);
                showNetworkStatus('error', 'æ·»åŠ ç½‘ç»œå¤±è´¥: ' + error.message);
            }
        }

        // è®¾ç½®è¡¨å•ç›‘å¬å™¨
        function setupFormListeners() {
            // å®æ—¶é¢„è§ˆ
            ['tokenName', 'tokenSymbol', 'initialSupply', 'description'].forEach(id => {
                document.getElementById(id).addEventListener('input', updatePreview);
            });

            // è¡¨å•æäº¤
            document.getElementById('tokenForm').addEventListener('submit', handleTokenCreation);
            
            // è¿æ¥é’±åŒ…æŒ‰é’®
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const name = document.getElementById('tokenName').value || '-';
            const symbol = document.getElementById('tokenSymbol').value.toUpperCase() || '-';
            const supply = document.getElementById('initialSupply').value || '-';
            const description = document.getElementById('description').value || 'æš‚æ— æè¿°';

            document.getElementById('previewName').textContent = name;
            document.getElementById('previewSymbol').textContent = symbol;
            document.getElementById('previewSupply').textContent = supply;
            document.getElementById('previewDescription').textContent = description;

            // æ˜¾ç¤ºé¢„è§ˆåŒºåŸŸ
            const preview = document.getElementById('tokenPreview');
            if (name !== '-' || symbol !== '-' || supply !== '-') {
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        // å¤„ç†ä»£å¸åˆ›å»º
        async function handleTokenCreation(event) {
            event.preventDefault();
            
            if (!userAccount || !tokenFactoryContract) {
                showNetworkStatus('error', 'è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }

            const name = document.getElementById('tokenName').value.trim();
            const symbol = document.getElementById('tokenSymbol').value.trim().toUpperCase();
            const initialSupply = document.getElementById('initialSupply').value;

            // éªŒè¯è¾“å…¥
            if (!name || !symbol || !initialSupply) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…è¦ä¿¡æ¯');
                return;
            }

            if (parseInt(initialSupply) <= 0) {
                alert('åˆå§‹ä¾›åº”é‡å¿…é¡»å¤§äº0');
                return;
            }

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showLoading(true);
                updateStepIndicator(3);
                
                // è°ƒç”¨åˆçº¦åˆ›å»ºä»£å¸è¯·æ±‚
                const tx = await tokenFactoryContract.requestTokenCreation(
                    name,
                    symbol,
                    ethers.utils.parseEther(initialSupply),
                    {
                        value: ethers.utils.parseEther("0.001") // 0.001 ETH åˆ›å»ºè´¹ç”¨
                    }
                );

                showNetworkStatus('info', 'äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...');
                
                // ç­‰å¾…äº¤æ˜“ç¡®è®¤
                const receipt = await tx.wait();
                
                showLoading(false);
                
                // æ˜¾ç¤ºæˆåŠŸç»“æœ
                showSuccessResult({
                    name,
                    symbol,
                    initialSupply,
                    txHash: receipt.transactionHash,
                    blockNumber: receipt.blockNumber,
                    gasUsed: receipt.gasUsed.toString()
                });

            } catch (error) {
                console.error('åˆ›å»ºä»£å¸å¤±è´¥:', error);
                showLoading(false);
                
                let errorMessage = 'åˆ›å»ºå¤±è´¥';
                if (error.message.includes('insufficient funds')) {
                    errorMessage = 'ä½™é¢ä¸è¶³ï¼Œè¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„ETHæ”¯ä»˜gasè´¹ç”¨å’Œåˆ›å»ºè´¹ç”¨';
                } else if (error.message.includes('user rejected')) {
                    errorMessage = 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“';
                } else {
                    errorMessage = 'åˆ›å»ºå¤±è´¥: ' + error.message;
                }
                
                showNetworkStatus('error', errorMessage);
            }
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            const form = document.getElementById('tokenForm');
            
            if (show) {
                spinner.style.display = 'block';
                form.style.opacity = '0.5';
                form.style.pointerEvents = 'none';
            } else {
                spinner.style.display = 'none';
                form.style.opacity = '1';
                form.style.pointerEvents = 'auto';
            }
        }

        // æ˜¾ç¤ºæˆåŠŸç»“æœ
        function showSuccessResult(result) {
            const resultBody = document.getElementById('resultBody');
            resultBody.innerHTML = `
                <div class="text-center mb-4">
                    <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
                    <h4 class="mt-3">ğŸ‰ ä»£å¸åˆ›å»ºè¯·æ±‚æˆåŠŸï¼</h4>
                    <p class="text-muted">æ‚¨çš„ä»£å¸åˆ›å»ºè¯·æ±‚å·²æäº¤åˆ°åŒºå—é“¾</p>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ä»£å¸åç§°</label>
                        <div class="form-control">${result.name}</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ä»£å¸ç¬¦å·</label>
                        <div class="form-control">${result.symbol}</div>
                    </div>
                    <div class="col-12 mb-3">
                        <label class="form-label fw-bold">åˆå§‹ä¾›åº”é‡</label>
                        <div class="form-control">${result.initialSupply} ${result.symbol}</div>
                    </div>
                    <div class="col-12 mb-3">
                        <label class="form-label fw-bold">äº¤æ˜“å“ˆå¸Œ</label>
                        <div class="form-control font-monospace small">${result.txHash}</div>
                        <a href="${NETWORK_CONFIG.explorer}/tx/${result.txHash}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">
                            <i class="fas fa-external-link-alt me-1"></i>åœ¨åŒºå—é“¾æµè§ˆå™¨æŸ¥çœ‹
                        </a>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <h6 class="alert-heading">ä¸‹ä¸€æ­¥</h6>
                    <ul class="mb-0">
                        <li>æ‚¨çš„ä»£å¸åˆ›å»ºè¯·æ±‚å·²è®°å½•åœ¨åŒºå—é“¾ä¸Š</li>
                        <li>æ‚¨å¯ä»¥åœ¨<a href="dashboard.html">ä»ªè¡¨æ¿</a>æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯</li>
                    </ul>
                </div>
            `;
            
            new bootstrap.Modal(document.getElementById('resultModal')).show();
        }

        // æ˜¾ç¤ºç½‘ç»œçŠ¶æ€
        function showNetworkStatus(type, message) {
            const statusDiv = document.getElementById('networkStatus');
            const alertClass = type === 'success' ? 'alert-success' : 
                              type === 'warning' ? 'alert-warning' : 
                              type === 'info' ? 'alert-info' : 'alert-danger';
            
            statusDiv.innerHTML = `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'warning' ? 'exclamation-triangle' : type === 'info' ? 'info' : 'times'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        }

        // æ›´æ–°è¿æ¥æŒ‰é’®
        function updateConnectButton(connected) {
            const btn = document.getElementById('connectWallet');
            if (connected) {
                btn.textContent = 'å·²è¿æ¥';
                btn.className = 'btn btn-success';
            } else {
                btn.innerHTML = '<i class="fas fa-wallet me-2"></i>è¿æ¥é’±åŒ…';
                btn.className = 'btn btn-outline-primary';
            }
        }

        // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
        function updateStepIndicator(step) {
            document.querySelectorAll('.step').forEach((el, index) => {
                if (index + 1 <= step) {
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                }
            });
        }

        // åˆ›å»ºå¦ä¸€ä¸ªä»£å¸
        function createAnother() {
            location.reload();
        }

        // ç›‘å¬è´¦æˆ·å’Œç½‘ç»œå˜åŒ–
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    userAccount = null;
                    signer = null;
                    tokenFactoryContract = null;
                    updateConnectButton(false);
                    updateStepIndicator(1);
                    showNetworkStatus('warning', 'é’±åŒ…å·²æ–­å¼€è¿æ¥');
                } else {
                    connectWallet();
                }
            });

            window.ethereum.on('chainChanged', function (chainId) {
                window.location.reload();
            });
        }
    </script>
</body>
</html> 